#gcc -O3 -march=native -flto lang.c#license:john morris beck gpl2 @ gnu.org
#malloc and free for mmap an munmap, and make the files be in /dev/shm or fallback to /dev/tmp if shm is unavailable
#a special naming scheme with guarnteed unique filenames based on timestamp, process id, and a random string from /dev/urandom allows
#for optional shared memory between vm processes. shared memory is intended to be used immutably where possible else with locks
BEGIN{printf "%s" "#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\nmain(){int i[16],*t;void* p[16];*i=1;*p=&t;while(1){"}{if( $1==0 ){j="exit(0)"}else if ($1==1 ){j="i[" $2 "]-=i[" $3 "]"}else if ($1==2 ){j="i[" $2 "]=i[" $2 "]<i[" $3 "]"}else if ($1==3){j="p[" $3 "]=p[" $2 "]"}else if ($1==4 ){j="i[" $3 "]=i[" $2 "]"}else if ($1==5 ){j="p[" $3 "]=*(void**)p[" $2 "]"}else if ($1==6 ){j="*(void**)p[" $3 "]=p[" $2 "]"}else if ($1==7 ){j="p[" $3 "]=(void*)((char*)(p[" $3 "]+(int)i[" $2 "]))"}else if ($1==8 ){j="p[" $3 "]=malloc(i[" $2 "]);i[" $2 "]=(p[" $3 "]==NULL)"}else if ($1== 9 ){j="i[" $2 "]=(p[" $3 "]==NULL);free(p[" $3 "])"}else if ($1==10 ){j="fread(p[" $3 "],1,i[" $3 "],stdin)"}else if ($1==11 ){j="fwrite(p[" $3 "],1,i[" $3 "],stdout);fflush(stdout))"}printf "%s%s" j ";"}END{printf %s "}}}"}

